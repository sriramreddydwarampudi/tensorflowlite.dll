
name: Build TensorFlow Lite C Library (Windows)

on:
  workflow_dispatch:

jobs:
  build-tflite-c:
	runs-on: ubuntu-latest
	steps:
	  - name: Checkout repository
		uses: actions/checkout@v3

	  - name: Install dependencies
		run: |
		  sudo apt-get update
		  sudo apt-get install -y wget git tar

	  - name: Download Bazelisk
		run: |
		  wget https://github.com/bazelbuild/bazelisk/releases/download/v1.19.0/bazelisk-linux-amd64 -O bazelisk
		  chmod +x bazelisk
		  ./bazelisk --version

	  - name: Clone TensorFlow
		run: |
		  rm -rf tensorflow
		  git clone --depth 1 --branch v2.18.0 https://github.com/tensorflow/tensorflow.git

	  - name: Build TensorFlow Lite C library
		run: |
		  cd tensorflow
		  ../bazelisk build -c opt //tensorflow/lite/c:tensorflowlite_c

	  - name: Locate built library
		run: |
		  cd tensorflow
		  find bazel-bin -name "*tensorflowlite_c*"

	  - name: Copy outputs
		run: |
		  mkdir -p ${{ github.workspace }}/output
		  cp -r tensorflow/bazel-bin/tensorflow/lite/c/* ${{ github.workspace }}/output/ 2>/dev/null || true
		  find ${{ github.workspace }}/output -type f

	  - name: Copy headers
		run: |
		  mkdir -p ${{ github.workspace }}/output/include
		  cp tensorflow/tensorflow/lite/c/*.h ${{ github.workspace }}/output/include/

	  - name: List results
		run: |
		  ls -lh ${{ github.workspace }}/output/

	  - name: Archive output
		run: |
		  tar -czf tensorflowlite_c.tar.gz output/

	  - name: Upload artifact
		uses: actions/upload-artifact@v3
		with:
		  name: tensorflowlite_c
		  path: tensorflowlite_c.tar.gz
